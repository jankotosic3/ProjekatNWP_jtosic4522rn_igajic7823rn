<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <form (ngSubmit)="onSearch()" class="mb-3">
        <div class="input-group mb-3">
          <select
            class="form-select bg-secondary text-light border-secondary"
            aria-placeholder="Machine Status"
            style="max-width: 100px"
            [(ngModel)]="searchStatus"
            [ngModelOptions]="{ standalone: true }"
          >
            <option [ngValue]="null">Both</option>
            <option [ngValue]="MachineStatus.Free">Free</option>
            <option [ngValue]="MachineStatus.InUse">In use</option>
          </select>
          <input
            [(ngModel)]="searchName"
            [ngModelOptions]="{ standalone: true }"
            type="text"
            class="form-control bg-secondary text-light border-secondary"
            placeholder="Machine name"
          />
          <button class="btn btn-info fw-semibold px-4" type="submit">
            Search
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="container bg-dark text-light p-4 rounded-4 shadow-lg mt-4">
  <h4 class="mb-3 border-bottom border-secondary pb-2">Machine Table</h4>

  <table class="table table-dark">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Machine name</th>
        <th scope="col">Creator</th>
        <th scope="col">Status</th>
        <th scope="col">Active</th>
        @if(loggedInUser?.turnOnMachinePermission){
        <th scope="col">Turn on</th>
        } @if(loggedInUser?.turnOffMachinePermission){
        <th scope="col">Turn off</th>
        } @if(loggedInUser?.restartMachinePermission){
        <th scope="col">Restart</th>
        }
      </tr>
    </thead>
    <tbody>
      @for (machine of machines; track machine.id) {
      <tr>
        <th scope="row">{{ machine.id }}</th>
        <td>{{ machine.machineName }}</td>
        <td>{{ getUserNameForMachine(machine.creatorId) }}</td>
        <td>{{ MachineStatus[machine.status] }}</td>
        <td>{{ machine.active }}</td>

        @if(loggedInUser?.turnOnMachinePermission){
        <td>
          <button type="button" class="btn btn-danger fw-semibold px-4" (click)="onTurnOnMachine(machine)">
            Turn on
          </button>
        </td>
        } @if(loggedInUser?.turnOffMachinePermission){
        <td>
          <button type="button" class="btn btn-danger fw-semibold px-4" (click)="onTurnOffMachine(machine)">
            Turn off
          </button>
        </td>
        } @if(loggedInUser?.restartMachinePermission){
        <td>
          <button type="button" class="btn btn-danger fw-semibold px-4" (click)="onRestartMachine(machine)">
            Restart
          </button>
        </td>
        }
      </tr>
      }
    </tbody>
  </table>

  @if(loggedInUser?.createMachinePermission){
  <div class="text-end">
    <button
      type="button"
      class="btn btn-info fw-semibold px-4"
      (click)="onNewMachine()"
    >
      + Add new machine
    </button>
  </div>
  }
</div>
